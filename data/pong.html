<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>High-Tech Neon Pong</title>
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.9); color: #0f0;
      font-family: 'Segoe UI', sans-serif; font-size: 2rem;
      flex-direction: column; z-index: 10;
    }
    #overlay button {
      margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem;
      color: #000; background: #0f0; border: none; cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <div>üöÄ Neon Pong 3000 üöÄ</div>
    <button id="startBtn">Start Game</button>
  </div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx    = canvas.getContext('2d');
    let W, H;
    function resize() {
      W = canvas.width  = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // paddles & ball
    const paddleW = 20, paddleH = 120, paddleSpeed = 6;
    const ballR = 12;
    let playerY = (H - paddleH)/2, aiY = (H - paddleH)/2;
    let ball = { x:W/2, y:H/2, vx:7, vy:4 };
    let score = { player:0, ai:0 };
    let particles = [];
    const speedUp = 1.5;

    // Easter egg flag
    let easterEggFound = false;

    // audio
    const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    function beep(f,d){ const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;o.start();o.stop(audioCtx.currentTime+d); }

    // controls
    const keys = {};
    window.addEventListener('keydown', e=>keys[e.key]=true);
    window.addEventListener('keyup',   e=>keys[e.key]=false);
    canvas.addEventListener('touchmove', e=>playerY = e.touches[0].clientY - paddleH/2);

    // AI prediction
    function predictBallY(){
      let x=ball.x, y=ball.y, vx=ball.vx, vy=ball.vy;
      while(true){
        x+=vx; y+=vy;
        if(y<ballR){ y=ballR; vy*=-1; }
        if(y>H-ballR){ y=H-ballR; vy*=-1; }
        if(vx>0 && x>=W-paddleW-ballR) return y;
        if(vx<0 && x< W/2) return H/2;
      }
    }
    function updateAI(){
      const tgt = predictBallY() - paddleH/2;
      aiY += (aiY + paddleH/2 < tgt ? 1.2 : -1.2)*paddleSpeed;
      aiY = Math.max(0, Math.min(H-paddleH, aiY));
    }

    // particles
    function emit(x,y){
      for(let i=0;i<15;i++){
        particles.push({ x, y, dx:(Math.random()-0.5)*4, dy:(Math.random()-0.5)*4, life:30 });
      }
    }

    // overlay & state
    const overlay = document.getElementById('overlay');
    let gameRunning = false;

    function startGame(){
      score.player = 0; score.ai = 0;
      easterEggFound = false;
      overlay.style.display = 'none';
      resetBall();
      gameRunning = true;
      loop();
    }

    function showEasterEgg(){
      gameRunning = false;
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div>üê£ You found the Easter Egg!<br/>Made by intern Justin Rao</div>
        <button id="continueBtn">Continue</button>
      `;
      document.getElementById('continueBtn').onclick = () => {
        overlay.style.display = 'none';
        easterEggFound = true;
        gameRunning = true;
        loop();
      };
    }

    function endGame(result){
      gameRunning = false;
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div>${result==='win' ? 'üéâ You Win! üéâ' : 'üí• You Lose! üí•'}</div>
        <button id="startBtn">Play Again</button>
      `;
      document.getElementById('startBtn').onclick = startGame;
    }

    function resetBall(){
      ball.x  = W/2; ball.y  = H/2;
      ball.vx = (Math.random()>0.5?1:-1)*(7+Math.random()*3);
      ball.vy = (Math.random()>0.5?1:-1)*(4+Math.random()*2);
    }

    function update(){
      // move paddles
      if(keys['w']||keys['W']) playerY -= paddleSpeed;
      if(keys['s']||keys['S']) playerY += paddleSpeed;
      playerY = Math.max(0, Math.min(H-paddleH, playerY));
      updateAI();

      // move ball
      ball.x += ball.vx; ball.y += ball.vy;

      // bounce off top/bottom
      if(ball.y<ballR||ball.y>H-ballR){
        ball.vy*=-1; beep(200,0.05);
      }

      // paddle collisions
      if(ball.x-ballR < paddleW &&
         ball.y>playerY && ball.y<playerY+paddleH){
        ball.vx *= -1*speedUp;
        ball.vy *= speedUp;
        ball.x = paddleW+ballR;
        beep(400,0.05);
        emit(ball.x,ball.y);
      }
      if(ball.x+ballR > W-paddleW &&
         ball.y>aiY    && ball.y<aiY   +paddleH){
        ball.vx *= -1*speedUp;
        ball.vy *= speedUp;
        ball.x = W-paddleW-ballR;
        beep(600,0.05);
        emit(ball.x,ball.y);
      }

      // scoring
      if(ball.x < -ballR){
        score.ai++;
        if(!easterEggFound && score.player===3 && score.ai===3){
          showEasterEgg(); return;
        }
        if(score.ai >= 5) return endGame('lose');
        resetBall();
      }
      if(ball.x > W+ballR){
        score.player++;
        if(!easterEggFound && score.player===3 && score.ai===3){
          showEasterEgg(); return;
        }
        if(score.player >= 5) return endGame('win');
        resetBall();
      }

      // particles
      particles = particles.filter(p=>p.life>0);
      particles.forEach(p => {
        p.x += p.dx; p.y += p.dy; p.life--;
      });
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      // net
      ctx.fillStyle = '#0f0'; ctx.shadowBlur=0;
      for(let y=0;y<H;y+=40) ctx.fillRect(W/2-1,y,2,20);

      // paddles
      ctx.fillStyle='#0f0'; ctx.shadowBlur=20; ctx.shadowColor='#0f0';
      ctx.fillRect(0,playerY,paddleW,paddleH);
      ctx.fillRect(W-paddleW,aiY,paddleW,paddleH);

      // ball
      ctx.beginPath();
      ctx.arc(ball.x,ball.y,ballR,0,Math.PI*2);
      ctx.fill(); ctx.shadowBlur=20; ctx.shadowColor='#0f0';

      // particles
      particles.forEach(p=>{
        ctx.globalAlpha = p.life/30;
        ctx.beginPath();
        ctx.arc(p.x,p.y,3,0,Math.PI*2);
        ctx.fill();
      });
      ctx.globalAlpha = 1;

      // score
      ctx.shadowBlur=0; ctx.fillStyle='#0f0';
      ctx.font='48px Segoe UI';
      ctx.fillText(score.player, W*0.25, 60);
      ctx.fillText(score.ai,     W*0.75, 60);
    }

    function loop(){
      if(!gameRunning) return;
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // hook up initial button
    document.getElementById('startBtn').onclick = startGame;
  </script>
</body>
</html>
